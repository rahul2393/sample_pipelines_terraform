language: go

go:
  - 1.9

resources:
  - name: my_integration
    type: integration
    integration: my_integration

build:
  ci:
    - echo $MY_INTEGRATION_INTEGRATION_ACCESSKEY
    - echo $(shipctl get_integration_resource_field MY_INTEGRATION secretKey)
    - export AWS_ACCESS_KEY_ID=$MY_INTEGRATION_INTEGRATION_ACCESSKEY
    - export AWS_SECRET_ACCESS_KEY=$MY_INTEGRATION_INTEGRATION_SECRETKEY
    - export AWS_DEFAULT_REGION="ap-south-1"
    - echo $AWS_ACCESS_KEY_ID
    - echo $AWS_SECRET_ACCESS_KEY
    - FILE_NAME=terraform_0.7.4_linux_amd64.zip
    - sudo apt-get update && apt-get install wget jq unzip
    - wget https://releases.hashicorp.com/terraform/0.7.4/$FILE_NAME
    - unzip $FILE_NAME -d $(pwd)
    - export PATH=$PATH:/build

    - terraform init
    - terraform plan
    - terraform apply -auto-approve